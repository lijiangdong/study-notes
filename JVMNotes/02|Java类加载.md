# java类加载

## **类加载时机**

类从被加载到虚拟机内存开始，到卸载出内存为止。它的整个生命周期包括：加载（Loading）、验证（Verification）、准备（Preparation）、解析（Resolution）、初始化（Initialization）、使用（Using）和卸载（Unloading）7个阶段。其中验证、准备、解析3阶段统称为连接（Linking）。

![](./imgs/02-1.png)

对于开始类加载过程的第一个阶段**加载**，Java虚拟机并没有强制约束，可以交给虚拟机自由把握。但是对于初始化阶段，虚拟机规范严格规定了有且只有5种情况必需立即对类进行“初始化”（而加载、验证、准备需要再这之前开始）

- 遇到new、getstatic、putstatic或invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先初始化。生成这4条指令最常见的Java代码场景是：使用new关键字实例化对象的时候、读取或设置一了类的静态字段（被final修饰、已在编译期把结果放到常量池的静态字段除外）的时候，以及调用一个类的静态方法。
- 使用java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。
- 当初始化一个类的时候，如果发现其父类还没有进行初始化，则需要先触发其父类的初始化。
- 当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。
- 当JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果 REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先进行初始化。

> 注：当一个类在初始化时，要求其父类全部都已经初始化过了，但是一个接口在初始化的时，并不要求其父接口全部都完成了初始化，只有在真正使用到父类接口的时候（如引用父类定义的常量）才会初始化。

## **类加载过程**

**加载**
**验证**
**准备**
**解析**
**初始化**

## **类加载器**



